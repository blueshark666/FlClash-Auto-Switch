jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: recursive

      # ----------- 缓存加速：Android SDK / NDK -----------
      - name: Cache Android SDK
        uses: actions/cache@v3
        with:
          path: |
            ~/.android
            $ANDROID_HOME/ndk
            $ANDROID_HOME/platforms
            $ANDROID_HOME/build-tools
            $ANDROID_HOME/cmake
          key: android-sdk-${{ hashFiles('android/app/build.gradle') }}
          restore-keys: android-sdk-

      # ----------- 缓存加速：Go 构建（libclash.so） -----------
      - name: Cache Go Build
        uses: actions/cache@v3
        with:
          path: |
            ~/go/pkg/mod
            ~/.cache/go-build
          key: go-cache-${{ hashFiles('core/go.sum') }}
          restore-keys: go-cache-

      # ----------- 缓存加速：Flutter/Dart 编译缓存 -----------
      - name: Cache Flutter Build
        uses: actions/cache@v3
        with:
          path: |
            .dart_tool
            build
            ~/.pub-cache
            ${{ runner.tool_cache }}/flutter
          key: flutter-build-${{ hashFiles('pubspec.lock') }}
          restore-keys: flutter-build-

      # ----------- 缓存 Gradle -----------
      - name: Cache Gradle
        uses: actions/cache@v3
        with:
          path: |
            ~/.gradle/caches
            ~/.gradle/wrapper
          key: gradle-${{ hashFiles('**/*.gradle*') }}
          restore-keys: gradle-